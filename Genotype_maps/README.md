# Genotype maps

This folder contains all scripts used to generate the genotype maps (Extended Data Fig. 3–9, 11–13, 15).
Two scripts are required and must be located in the same folder:

- `get_phenotype_genotype_file.sh`  
  Generates the phenotype–genotype input file in the correct format.

- `heatmap.R`  
  Generates the genotype heatmap from the formatted input data.

## 1) Prepare the data for the analysis

This analysis requires the following input files:

- A GWAS file generated by GEMMA with four columns:
  (1) chromosome or scaffold name
  (2) scaffold:position
  (3) position
  (4) p-value  
  See `Example_GWAS_input.txt` for an example.

- A VCF file for the focal or ingroup species.

- A VCF file for the other closely related or comimetic species.

- A phenotype file for the focal or ingroup species with three columns:
  (1) sample ID
  (2) species
  (3) phenotype  
  See `Focal_species_information.txt`.

- A phenotype file for the other closely related or comimetic species with three columns:
  (1) sample ID
  (2) species
  (3) phenotype  
  See `Multisp_information.txt`.

- An order file indicating the display order of the focal or ingroup species followed by the other species in the genotype map.  
  See `order_file.txt`.

- A color file specifying the color associated with each phenotype.  
  See `Color.txt`.

## 2) Running the script

To run the full script, use the following command:

```bash
GWAS="Example_GWAS_input.txt"
Focal_VCF="Focal_species.vcf.gz"
MULTI_VCF="Other_species.vcf.gz"
PHENO="Focal_species_information.txt"
ORDER="order_file.txt"
MULTI_PHENO="Multisp_information.txt"
COLORS="Color.txt"

Rscript ./heatmap.R \
  -s species \
  -g gene \
  -w $GWAS \
  -f $Focal_VCF \
  -m $MULTI_VCF \
  -r $SCAFFOLD \
  -x $START \
  -y $END \
  -p $PHENO \
  -q $MULTI_PHENO \
  -t $THRESHOLD \
  -o $ORDER \
  -c $COLORS
```

---

### List of parameters

- `-s <species>`  
  Species name. Appended to all generated output files.

- `-g <gene>`  
  Gene name. Appended to all generated output files.

- `-w <gwas>`  
  GWAS output generated by GEMMA (e.g. `Example_GWAS_input.txt`).

- `-f <vcf_focal>`  
  VCF used to perform the GWAS.

- `-m <vcf_multi>`  
  VCF containing the non-focal species genotypes (it may also contain focal samples; these will be removed by the script).  
  This VCF must contain all SNPs present in the focal VCF. Additional SNPs are allowed, but missing SNPs will cause the script to fail.

- `-r <scaffold>`  
  Scaffold or chromosome of the peak region used for the heatmap.

- `-x <start_pos>`  
  Start position of the peak.

- `-y <end_pos>`  
  End position of the peak.

- `-p <phen_focal>`  
  Three-column, tab-separated file with sample ID, subspecies name, and phenotype (label hybrids as "intermediate" or "hybrid") for the samples used in the GWAS.  
  Example: `Focal_species_information.txt`.

- `-q <phen_multi>`  
  Three-column, tab-separated file with sample ID, subspecies or species name, and phenotype for all multispecies samples.  
  Example: `Multisp_information.txt`.

- `-t <threshold>`  
  -log10(p-value) threshold above which SNPs are plotted in the heatmap.

- `-o <samples_order_file>`  
  File specifying the order in which subspecies appear in the heatmap.  
  Example: `order_file.txt`.

- `-c <color_phenotypes>`  
  File specifying the mapping between phenotypes and colors.  
  Example: `Color.txt`.


